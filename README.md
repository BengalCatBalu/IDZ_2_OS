# IDZ_2_OS Ефимов Иван БПИ 212

### Условие задачи(Вариант №28)

<h5>Задача о Винни-Пухе – 3 или мстительные пчелы.</h5> Неправильные пчелы, подсчитав в конце месяца убытки от наличия в
лесу Винни-Пуха, решили разыскать его и наказать в назидание
всем другим любителям сладкого. Для поисков медведя они поделили лес на участки, каждый из которых прочесывает одна стая
неправильных пчел. В случае нахождения медведя на своем участке стая проводит показательное наказание и возвращается в улей.
Если участок прочесан, а Винни-Пух на нем не обнаружен, стая
также возвращается в улей. Там она получает информацию об еще
неисследованных участках и снова улетает. Требуется создать
приложение, моделирующее действия пчел. Каждая стая
— отдельный процесс. Время обследования участка задается случайно.

### Сценарий работы программы

Допустим, что программа была запущена с параметрами NUM_BEES=3 и NUM_SECTORS=5. В этом случае сценарий работы может выглядеть следующим образом:

- Создается разделяемая память с данными: количество неисследованных участков устанавливается в 5, инициализируется семафор.
Создается 3 процесса-пчелы.
- Все пчелы начинают свою работу и ищут Винни-Пуха на участках леса.
- Пчелы забирают участки по очереди, контролируя доступ к разделяемой памяти с помощью семафора.
- Каждая пчела может занять разное время на поиск на участке, поэтому порядок их работы может быть непредсказуемым.

#### Пример вывода программы:

```
Bee 0 is searching sector for 2 seconds...
Bee 1 is searching sector for 4 seconds...
Bee 2 is searching sector for 3 seconds...
Bee 0 is searching sector for 1 seconds...
Bee 2 finished searching.
Bee 1 finished searching.
Bee 0 finished searching.
All bees have finished searching.
```

После завершения всех процессов-пчел, программа выводит сообщение "All bees have finished searching." и корректно завершает свою работу, уничтожая семафоры и освобождая разделяемую память.

### Предполагаемая оценка - 6

Представлены три файла

- unnamed_semaphore.c (4)
- named_semaphore.c (5)
- UNIX_System_v.c (6)

Комментарии к коду предоставлены только в файле unnamed_semaphore.c
Ниже же представлена краткая информация по переходу к named_semaphore и UNIX_System_V

### Unnamed -> Named

1. Функции sem_init() и sem_destroy() были заменены на sem_open(), sem_close() и sem_unlink(). Создание семафора происходит с помощью sem_open() с заданным именем (SEM_NAME). Важно также вызвать sem_unlink() перед созданием семафора, чтобы удалить существующий семафор с таким же именем.
```c
sem_unlink(SEM_NAME);
sem_t *sem = sem_open(SEM_NAME, O_CREAT, S_IRUSR | S_IWUSR, 1);
```

2. Вместо хранения семафора в разделяемой памяти, программа теперь использует именованный семафор, который доступен всем процессам по заданному имени (SEM_NAME).

3. В функции search_sector(), именованный семафор открывается с помощью sem_open(), используя имя семафора (SEM_NAME), и затем закрывается с помощью sem_close() перед завершением функции. Это необходимо сделать для каждого процесса-пчелы.
```c
sem_t *sem = sem_open(SEM_NAME, O_CREAT, S_IRUSR | S_IWUSR, 1);
// ...
sem_close(sem);
```

4. В функции main(), после завершения всех процессов-пчел, основной процесс закрывает именованный семафор с помощью sem_close() и удаляет его с помощью sem_unlink().
```c
sem_close(sem);
sem_unlink(SEM_NAME);
```

### UNIX System_V
1. Используются функции semget(), semctl(), semop() для работы с семафорами System V. Создание и удаление семафора происходят с помощью create_semaphore() и delete_semaphore(). Функции semaphore_wait() и semaphore_post() используются для ожидания и освобождения семафора.

2. Используются функции shmget(), shmat(), shmdt() и shmctl() для работы с разделяемой памятью System V. Создание и удаление разделяемой памяти происходят с помощью create_shared_data() и free_shared_data().


